sudo: true

git:
  depth: 3

addons:
  postgresql: "9.4"

language: python
python:
- "3.5"

branches:
  only:
    - dev
    - master

env:
 global:
  - DJANGO_SETTINGS_MODULE=config.settings.test
  - DATABASE_URL=postgres://postgres@localhost:5432

install:
  - pip install -r requirements/test.txt
  - pip install coveralls

script:
  - coverage run -m py.test
after_script:
  - coveralls


deploy:
  provider: heroku
  skip_cleanup: true

  api_key:
    secure: "7d7f1f6b-ea28-4a2b-9295-a32cf2092b40"
  strategy: git
  app:
    master: renty
    dev: renty-dev
  run:
    - "python ./manage.py syncdb --noinput"
    - "python ./manage.py migrate"
    - restart
